@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject IAuthenticationService AuthService

<FluentLayout>
    <FluentHeader Class="header-glass">
        <div class="header-container">
            <div class="header-content">
                <!-- Logo & Brand -->
                <div class="header-left">
                    <a href="/" class="brand-logo">
                        <div class="logo-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="brand-text">FeedBack</span>
                    </a>

                    <!-- Navigation -->
                    <nav class="nav-links">
                        <NavLink href="/" class="nav-link" Match="NavLinkMatch.All">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            <span>Home</span>
                        </NavLink>
                        <NavLink href="/movies" class="nav-link" Match="NavLinkMatch.Prefix">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                                <line x1="7" y1="2" x2="7" y2="22"/>
                                <line x1="17" y1="2" x2="17" y2="22"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                                <line x1="2" y1="7" x2="7" y2="7"/>
                                <line x1="2" y1="17" x2="7" y2="17"/>
                                <line x1="17" y1="17" x2="22" y2="17"/>
                                <line x1="17" y1="7" x2="22" y2="7"/>
                            </svg>
                            <span>Movies</span>
                        </NavLink>
                    </nav>
                </div>

                <!-- Auth Section -->
                <div class="header-right">
                    <AuthorizeView>
                        <Authorized Context="authContext">
                            <div class="user-section">
                                <div class="user-avatar">
                                    @(authContext.User.Identity?.Name?.FirstOrDefault().ToString().ToUpper() ?? "U")
                                </div>
                                <div class="user-info">
                                    <span class="user-name">@authContext.User.Identity?.Name</span>
                                    <AuthorizeView Roles="Admin" Context="adminContext">
                                        <span class="user-role">Admin</span>
                                    </AuthorizeView>
                                </div>
                                <button class="btn-logout" @onclick="LogoutAsync" title="Sign out">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16 17 21 12 16 7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                </button>
                            </div>
                        </Authorized>

                        <NotAuthorized>
                            <div class="auth-buttons">
                                <a href="/login" class="btn-signin">Sign in</a>
                                <a href="/register" class="btn-getstarted">
                                    Get started
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                        <polyline points="12 5 19 12 12 19"/>
                                    </svg>
                                </a>
                            </div>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>
        </div>
    </FluentHeader>

    <FluentBodyContent Class="flex-1 px-8 py-10 bg-neutral-950">
        <div class="max-w-6xl mx-auto">
            <FluentMessageBarProvider Section="@MessagesTop" />
            @Body
        </div>
    </FluentBodyContent>

    <FluentFooter Class="footer-glass">
        <div class="footer-content">
            <p class="footer-text">© @DateTime.Now.Year FeedBack App. Built with Blazor & .NET 10</p>
        </div>
    </FluentFooter>

    <FBUI.Components.AdminNotificationPanel />
</FluentLayout>

@code {
    private const string MessagesTop = "messages-top";

    private async Task LogoutAsync()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/");
    }
}